<div class="ticket-management-container">
  <h2 class="ticket-header">Ticket Management</h2>
 
  <div class="form-card">
    <form #ticketForm="ngForm" class="ticket-form">
      <div class="form-row">
        <div class="form-group">
          <label for="ticketId" class="form-label">Ticket ID</label>
          <input type="text" id="ticketId" name="TicketId" [(ngModel)]="ticket.ticketId" required class="form-input"
            placeholder="Enter ID" />
        </div>
        <div class="form-group">
          <label for="title" class="form-label">Title</label>
          <input type="text" id="title" name="Title" [(ngModel)]="ticket.title" required class="form-input"
            placeholder="Enter title" />
        </div>
 
        <div class="form-group">
          <label for="ticketTypeId" class="form-label">Type</label>
          <select id="ticketTypeId" name="ticketTypeId" [(ngModel)]="ticket.ticketTypeId"
            (ngModelChange)="onTicketTypeChange($event)" class="form-input">
            <option value="">Select Type</option>
            <option *ngFor="let tType of ticketTypes" [value]="tType.ticketTypeId">{{ tType.typeName }}</option>
          </select>
        </div>
        @if(role.toLocaleLowerCase() == "admin" || EditbyAssignerNo){
        <div class="form-group">
          <label for="status" class="form-label">Status</label>
          <select id="status" name="Status" [(ngModel)]="ticket.status" class="form-input">
            <option value="">Select Status</option>
            <option value="Open">Open</option>
            <option value="In Progress">In Progress</option>
            <option value="Closed">Closed</option>
          </select>
        </div>
        }
      </div>
 
      <div class="form-row">
          <div class="form-group">
            <label for="createdByEmpId" class="form-label">Created By</label>
            <input type="text" id="createdByEmpId" name="createdByEmpId" [(ngModel)]="ticket.createdByEmpId"
                  class="form-input" placeholder="Emp ID" disabled />
          </div>
        @if(role.toLocaleLowerCase() == "admin"){
        <div class="form-group">
          <label for="assignedToEmpId" class="form-label">Assigned To</label>
          <select id="assignedToEmpId" name="assignedToEmpId" [(ngModel)]="ticket.assignedToEmpId" class="form-input">
            <option value="">Select Employee</option>
            <option *ngFor="let emp of employeesbyDept" [value]="emp.empId">{{ emp.empName }}</option>
          </select>
        </div>
        }
        <div class="form-group form-group-wide">
          <label for="description" class="form-label">Description</label>
          <textarea id="description" name="Description" [(ngModel)]="ticket.description"
            class="form-input form-textarea" placeholder="Enter description"></textarea>
        </div>
      </div>
 
      <div class="action-buttons">
        <button type="button" class="action-btn add-btn" (click)="addTicket()">+ Add</button>
        <button type="button" class="action-btn search-btn" (click)="showTicket()">üîç Search</button>
        <button type="button" class="action-btn update-btn" (click)="updateTicket()">‚Üª Update</button>
        
        @if(role.toLocaleLowerCase() == "admin"){ 
          <button type="button" class="action-btn delete-btn" (click)="deleteTicket()">üóëÔ∏è Delete</button>
          <button type="button" class="action-btn show-btn" (click)="showAllTickets()"> üëÅÔ∏èShow All Tickets</button>
        }
      </div>
    </form>
  </div>
  <div *ngIf="errMsg" class="error-message">‚ö†Ô∏è {{ errMsg }}</div>
 
  @if(role.toLocaleLowerCase() == "admin"){
  <h3 class="filter-header">Filter Tickets</h3>
  <div class="filter-section">
    
    <div class="filter-card">
      <span class="filter-title">By Type</span>
      <div class="filter-control-group">
        <select class="filter-select" [(ngModel)]="filterTicketTypeId">
          <option value="">Select Type</option>
          <option *ngFor="let tType of ticketTypes" [value]="tType.ticketTypeId">{{ tType.typeName }}</option>
        </select>
        <button class="filter-apply-btn" (click)="getTicketsByType()">Filter</button>
      </div>
    </div>
    
    <div class="filter-card">
      <span class="filter-title">By Creator</span>
      <div class="filter-control-group">
        <select class="filter-select" [(ngModel)]="filterCreatedByEmpId">
          <option value="">Select Employee</option>
          <option *ngFor="let emp of employees" [value]="emp.empId">{{ emp.empName }}</option>
        </select>
        <button class="filter-apply-btn" (click)="getTicketsByCreator()">Filter</button>
      </div>
    </div>
    
    <div class="filter-card">
      <span class="filter-title">Assigned To</span>
      <div class="filter-control-group">
        <select class="filter-select" [(ngModel)]="filterAssignedToEmpId">
          <option value="">Select Employee</option>
          <option *ngFor="let emp of employees" [value]="emp.empId">{{ emp.empName }}</option>
        </select>
        <button class="filter-apply-btn" (click)="getTicketsAssignedToAdmin()">Filter</button>
      </div>
    </div>
    
    <div class="filter-card">
      <span class="filter-title">By Status</span>
      <div class="filter-control-group">
        <select class="filter-select" [(ngModel)]="filterStatus">
          <option value="">Select Status</option>
          <option value="Open">Open</option>
          <option value="In Progress">In Progress</option>
          <option value="Closed">Closed</option>
        </select>
        <button class="filter-apply-btn" (click)="filterTicketsByStatus()">Filter</button>
      </div>
    </div>

    
  </div>

  <div class="table-card">
<div class="table-header">
    <h3 class="list-header">Ticket List</h3>
  </div>
    <div class="table-wrapper">
      <table class="tickets-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Type</th>
            <th>Status</th>
            <th>Created By</th>
            <th>Assigned To</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of (isStatusFilter ? filteredTickets : tickets)">
            <td>{{ t.ticketId }}</td>
            <td>{{ t.title }}</td>
            <td>{{ t.ticketTypeId }}</td>
            <td><span class="status-badge status-{{t.status?.toLowerCase()?.replace(' ', '')}}">{{ t.status }}</span></td>
            <td>{{ t.createdByEmpId }}</td>
            <td>{{ t.assignedToEmpId }}</td>
            <td><button class="edit-btn" (click)="editTicket(t)">‚úèÔ∏è Edit</button></td>
          </tr>
          <tr *ngIf="tickets.length === 0">
            <td colspan="7" class="no-data">üì≠ No tickets found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  }
  @else {
  <h3 class="list-header">Ticket List by Creator</h3>
  <div class="table-card">
    <div class="table-wrapper">
      <table class="tickets-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Type</th>
            <th>Status</th>
            <th>Created By</th>
            <th>Assigned To</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of tickets">
            <td>{{ t.ticketId }}</td>
            <td>{{ t.title }}</td>
            <td>{{ t.ticketTypeId }}</td>
            <td><span class="status-badge status-{{t.status?.toLowerCase()?.replace(' ', '')}}">{{ t.status }}</span></td>
            <td>{{ t.createdByEmpId }}</td>
            <td>{{ t.assignedToEmpId }}</td>
            <td><button class="edit-btn" (click)="editTicket(t)">‚úèÔ∏è Edit</button></td>
          </tr>
          <tr *ngIf="tickets.length === 0">
            <td colspan="7" class="no-data">üì≠ No tickets found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
 
  <h3 class="list-header">Ticket List by Assigned</h3>
  <div class="table-card">
    <div class="table-wrapper">
      <table class="tickets-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Type</th>
            <th>Status</th>
            <th>Created By</th>
            <th>Assigned To</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of ticketsbyAssigner">
            <td>{{ t.ticketId }}</td>
            <td>{{ t.title }}</td>
            <td>{{ t.ticketTypeId }}</td>
            <td><span class="status-badge status-{{t.status?.toLowerCase()?.replace(' ', '')}}">{{ t.status }}</span></td>
            <td>{{ t.createdByEmpId }}</td>
            <td>{{ t.assignedToEmpId }}</td>
            <td><button class="edit-btn" (click)="editTicketsbyAssigner(t)">‚úèÔ∏è Edit</button></td>
          </tr>
          <tr *ngIf="ticketsbyAssigner.length === 0">
            <td colspan="7" class="no-data">üì≠ No tickets found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  }
</div>