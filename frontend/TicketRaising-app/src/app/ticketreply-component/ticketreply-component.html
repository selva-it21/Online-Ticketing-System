<div class="ticketreply-management-container">
  <h2 class="ticketreply-header">Ticket Reply Management</h2>
 
  <div class="form-card">
    <form class="ticketreply-form">
      <div class="single-row-form">
        <div class="form-group">
          <label for="replyId" class="form-label">Reply ID</label>
          <div class="input-with-button">
            <input type="text" id="replyId" [(ngModel)]="reply.replyId" name="replyId" class="form-input"
              placeholder="Enter ID" />
            <!-- <button type="button" class="inline-btn show-btn" (click)="getReply()">ğŸ‘ï¸ Show</button> -->
          </div>
        </div>
 
        <div class="form-group">
          <label for="ticketId" class="form-label">Ticket ID</label>
          <select id="ticketId" [(ngModel)]="reply.ticketId" (ngModelChange)="onTicketIdChange($event)" name="ticketId"
            class="form-input">
            <option value="">Select Ticket</option>
            <option *ngFor="let t of tickets" [value]="t.ticketId">{{ t.ticketId }}-{{ t.title}}</option>
          </select>
        </div>
      </div>
 
      <div class="single-row-form">
        <div class="form-group form-group-wide">
          <label for="replyMessage" class="form-label">Reply Message</label>
          <textarea id="replyMessage" [(ngModel)]="reply.replyMessage" name="replyMessage"
            class="form-input form-textarea" placeholder="Enter reply message"></textarea>
        </div>
      </div>

      <!-- Auto-determined replier info display -->
      <div *ngIf="reply.replyByCreatorEmpId || reply.replyByAssignedEmpId" class="replier-info">
        <strong>Replying as:</strong> 
        {{ reply.replyByCreatorEmpId ? 'Creator (' + reply.replyByCreatorEmpId + ')' : '' }}
        {{ reply.replyByAssignedEmpId ? 'Assigner (' + reply.replyByAssignedEmpId + ')' : '' }}
      </div>
 
      <div class="action-buttons">
        <button type="button" class="action-btn add-btn" (click)="addReply()">ğŸ’¾ Save</button>
        <button type="button" class="action-btn update-btn" (click)="updateReply()">â†» Update</button>
        <button type="button" class="action-btn delete-btn" (click)="deleteReply()">ğŸ—‘ï¸ Delete</button>
        <button type="button" class="action-btn show-all-btn" (click)="getReply()">ğŸ‘ï¸ Show</button>
      </div>
 
      <div *ngIf="errMsg" class="error-message">âš ï¸ {{ errMsg }}</div>
    </form>
  </div>
 
  <div class="table-card">
    <h3 class="list-header">Conversation</h3>
 
    <div class="conversation-card">
      <div class="conversation-body">
        @for (r of replies; track r) {
          <div
            class="chat-message"
            [class.sent]="r.replyByCreatorEmpId === creator"
            [class.received]="r.replyByAssignedEmpId === creator">
 
            <div class="chat-bubble">
              <div class="chat-text">{{ r.replyMessage }}</div>
              <div class="chat-meta">
                <span>{{ r.replyByCreatorEmpId || r.replyByAssignedEmpId }}</span>
              </div>
            </div>
          </div>
        }
 
        @empty {
          <div class="no-data">ğŸ“­ No conversation found</div>
        }
      </div>
    </div>
  </div>
</div>